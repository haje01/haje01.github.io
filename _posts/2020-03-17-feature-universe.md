---
layout: post
title: 온라인 게임을 위한 피처 유니버스 만들기
description:
date: 2020-03-17
tags: [ml, idea, draft]
---

다양한 기계학습 모델에서 피처는 핵심적인 역할을 한다. 이 글에서는 온라인 게임 서비스를 예로 하여 다양한 측면의 피처를 소개하고, 이를 이용해 종합적인 피처 셋을 구성하는 것을 살펴본다. 게임 외에도 다양한 서비스에 응용이 가능할 것으로 생각한다.

> 여기에서 소개하는 방법은 유저 군집 분류, 어뷰저 검출, 이탈 예측, 광고 최적화 등 다양한 모델을 염두에 둔 범용 피처 구성을 목표로 한다.

## 피처 유니버스란?

피처는 소스 데이터의 범위나 생성 방식에 따라 다양한 분류가 가능하다. 이 글에서는 주요 분류에 따라 피처들을 설명하고 이것을 통합하여 종합적인 피처 집합을 구성하는 것을 설명하는데, 이 집합을 **피처 유니버스 (Universe)** 로 부른다.

피처 유니버스는 크게 작업의 주체에 따라 수작업 피처와 합성 피처로 나뉜다.

## 수작업 피처

수작업 피처는 분석가나 데이터 엔지니어가 EDA와 코딩을 통해 만들어 내는 피처를 말한다. 수작업 피처는 크게 라이프 피처와 기간 피처로 나뉜다.

### 라이프 피처

유저의 서비스 가입 이후 존속 기간 (Life) 동안 발생한 특징. 이 피처들은 전체 로그나 별도 DB를 참고해 얻어 낸다.

예:
* 가입 일
* 가입 IP
* 가입 후 경과일
* 첫 플레이 일
* 첫 플레이 후 만랩까지 경과일
* 만랩 이후 경과일
* 총 접속일
* 첫 구매일
* 총 구매 수
* 첫 구매 후 경과일
* 가입 후 첫 구매까지 경과일
* 첫 번째 캐릭터 생성 후, 두 번째 캐릭터 생성까지 경과일
* 총 생성 캐릭터

### 기간 피처

하루 또는 특정 기간 동안의 로그에서 얻을 수 있는 유저별 피처들. 기간 피처는 주로 일/주/월 단위로 나뉘고, 기간 동안의 로그 데이터에서 얻는다. 단위 기간 피처가 연속되면 시계열 데이터를 구성하게 된다.

예:
* 플레이 시간
* 레벨/경험치 증가
* 아이템 습득 수
* 아이템 거래 수
* 채팅 및 기타 소셜 활동 수
* 던전/퀘스트 수행 수
* 아이템 강화 성공/실패 수
* 로그인 수
* 유니크 IP 수
* 결제 수

## 합성 피처

합성 피처 (Synthesized Feature)는 하나 이상의 수작업 또는 합성 피처를 이용해 자동으로 합성된 피처다. 최대한 많은 피처를 합성하여, 간과할 수 있는 중요 특성을 찾는 것을 목표로 한다. 예전에 소개한 Featuretools 의 [심층 피처 합성](https://haje01.github.io/2019/12/27/deep-feature-synthesis.html) 방식을 이용하면 손쉽게 다양한 합성피처를 생성할 수 있다.

합성 피처는 크게 유저 합성 피처와 코호트 합성 피처가 있다.

### 유저 합성 피처

각 유저별 또는 전체 유저에 대한 피처를 합성한다.

예:
* 플레이 시간의 분위수 (Quantile)
* 플레이 시간 변화의 기울기
* 플레이 시간의 표준 편차
* 유저의 최빈 접속 IP
* 유저의 최빈 접속 IP 의 평균 접속자 수

### 코호트 합성 피처

유저의 가입 시점/IP/경로 등의 기준으로 코호트 (집단) 를 구성하고, 이 코호트 중심으로 피처를 합성한 것. 코호트의 기준을 Featuretool 에 알리고 합성을 시도한다.

코호트의 기준은 다음과 같은 것들이 있다.

* 가입 시점 코호트
  * 가입 시점을 기준으로 한 유저들의 그룹
  * 일단위 모수가 너무 작으먄 주/월 등을 기준으로 할 수 있다.

* IP/CIP 코호트
    * 가입시 접속한 IP 기준 유저들의 그룹
    * IP 단위 모수가 너무 작으면 CIP (IP 주소에서 세 번째 자리까지만 고려한 것) 기준으로 할 수 있다.

* 광고 코호트
    * 특정 광고 캠페인을 통해 가입하게된 유저들의 그룹.

코호트 피처의 예:

* 최대 하루 가입 유저 수
* 최대 동시 접속 수
* 레벨 표준 편차
* 평균 플레이 시간
* 플레이 시간 표준 편차
* 평균 구매 수
* PU 비율
* 전체의 50% 이탈에 걸린 시간

## 피처 유니버스의 사용

수작업에 합성된 것까지 포함하면 굉장히 많은 피처의 유니버스가 구성될 것이다. 원활한 활용을 위해 다음과 같은 내용을 고려하자.

* 피처의 필터링 - 지나치게 많은 피처는 노이즈일 수 있다. 모델별로 필요한 피처가 다를 것이나, 최소한 유의미한 것 위주로 정리해 두자.
* 피처의 저장 - 생성된 피처는 반복 작업없이 다양한 분석에 활용될 수 있도록 저장해두자.
